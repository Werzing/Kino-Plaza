<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∏–Ω–æ–ü–ª–∞–∑–∞ - –ù–æ–≤–∏–Ω–∫–∏</title>
    <link rel="icon" type="image/x-icon" href="logo.png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ –≤ –≤–∏–¥–µ –∫–∏–Ω–æ–ø–ª–µ–Ω–∫–∏ -->
    <header class="header">
        <div class="film-frames"></div>
        <div class="header-content">
            <div class="logo">
                <span class="logo-kino">–ö–∏–Ω–æ</span>
                <span class="logo-plaza">–ü–ª–∞–∑–∞</span>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-item">–§–∏–ª—å–º—ã</a>
                <a href="directors.html" class="nav-item">–†–µ–∂–∏—Å—Å–µ—Ä—ã</a>
                <a href="genres.html" class="nav-item">–ñ–∞–Ω—Ä—ã</a>
                <a href="news.html" class="nav-item active">–ù–æ–≤–∏–Ω–∫–∏</a>
                <a href="admin.html" class="nav-item">–ê–¥–º–∏–Ω–∫–∞</a>
            </nav>
        </div>
    </header>

    <!-- –ë–∞–Ω–Ω–µ—Ä –Ω–æ–≤–∏–Ω–æ–∫ -->
    <section class="news-banner">
        <div class="banner-content">
            <h1>üéâ –ù–æ–≤—ã–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</h1>
            <p>–°–∞–º—ã–µ —Å–≤–µ–∂–∏–µ —Ñ–∏–ª—å–º—ã —É–∂–µ –≤ –Ω–∞—à–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ</p>
        </div>
    </section>
    
    <!-- –°–µ—Ç–∫–∞ –Ω–æ–≤–∏–Ω–æ–∫ -->
    <main class="movies-grid" id="newsContainer">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–∏–Ω–æ–∫...</div>
    </main>
    
    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer class="footer">
        <p>¬© 2024 –ö–∏–Ω–æ–ü–ª–∞–∑–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Supabase</p>
    </footer>

    <script>
        const supabaseUrl = 'https://syqlznhvvqfadbbqeltk.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5cWx6bmh2dnFmYWRiYnFlbHRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MzU5MzAsImV4cCI6MjA3NTMxMTkzMH0.JjFICdfFnFwp0_jfSxKIOn1Je87ZtMRPSTFvjxYF3-k'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        async function loadNews() {
            try {
                const currentYear = new Date().getFullYear();
                
                const { data: moviesData, error } = await supabase
                    .from('movies')
                    .select(`
                        *,
                        genres(name),
                        directors(full_name)
                    `)
                    .gte('release_year', currentYear - 1)
                    .order('release_year', { ascending: false })
                    .limit(12)
                
                if (error) throw error;
                
                displayNews(moviesData || []);
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–∏–Ω–æ–∫:', err)
                document.getElementById('newsContainer').innerHTML = 
                    '<div class="loading">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–∏–Ω–æ–∫</div>'
            }
        }

        function displayNews(movies) {
            const container = document.getElementById('newsContainer');
            
            if (!movies || movies.length === 0) {
                container.innerHTML = '<div class="loading">–ù–æ–≤–∏–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            container.innerHTML = movies.map(movie => `
                <div class="movie-card new-badge">
                    <div class="poster-container">
                        <img src="${movie.poster || 'https://via.placeholder.com/300x400/222222/cccccc?text=No+Poster'}" 
                             alt="${movie.title}" 
                             class="movie-poster"
                             onerror="this.src='https://via.placeholder.com/300x400/222222/cccccc?text=No+Poster'">
                        <div class="new-label">NEW</div>
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-meta">
                            <span>${movie.release_year}</span>
                            <span>${movie.genres?.name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</span>
                            <div class="movie-rating">
                                <span>‚òÖ</span> ${movie.rating || 'N/A'}
                            </div>
                        </div>
                        <div class="movie-description">
                            ${movie.plot || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.'}
                        </div>
                        <div class="movie-details">
                            <span>${movie.duration_minutes || '??'} –º–∏–Ω.</span>
                            <span>${movie.directors?.full_name || '–†–µ–∂–∏—Å—Å–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', loadNews);
    </script>
</body>
</html>